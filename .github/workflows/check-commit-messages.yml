name: 'Commit Message Check'
on:
  pull_request:
    types:
      - opened
      - edited
      - reopened
      - synchronize
  pull_request_target:
    types:
      - opened
      - edited
      - reopened
      - synchronize

jobs:
  check-commit-message:
    name: Check Commit Message
    runs-on: ubuntu-latest
    steps:
      - name: Check Commit Type
        uses: gsactions/commit-message-checker@v1
        with:
          pattern: '\[#\d+\] - .+$'
          flags: 'g'
          excludeDescription: 'true'
          excludeTitle: 'true'
          checkAllCommitMessages: 'true'
          accessToken: ${{ secrets.GITHUB_TOKEN }}
          error: 'The commit message should be formatted as "[#TASK_ID] - message"'
      - name: Get current branch name
        id: current_branch
        uses: ryolambert/current-branch@v1.0
      - name: Check current branch name
        shell: python
        run: |
          import re
          branch = {{ steps.current_branch.outputs.branch }}
          assert re.match(r"^[\d|\w]+/#\d+-.+", branch), 'The branch should be formatted as "type/#TASK_ID-description"'